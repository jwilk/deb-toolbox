#!/bin/sh

# Copyright Â© 2017-2023 Jakub Wilk <jwilk@jwilk.net>
# SPDX-License-Identifier: MIT

set -e -u

urlescape()
{
    perl -E '$_ = $ARGV[0]; s/[^\w.-]/sprintf "%%%02X", ord $&/ge; say $_' "$@"
}

if [ $# -ne 1 ]
then
    printf 'Usage: %s PACKAGE\n' "${0##*/}" >&2
    exit 1
fi

pkg="$1"
pkgs=$(apt-cache showsrc -- "$pkg" | grep-dctrl -ns Package '' | sort -u)
if [ -z "$pkgs" ]
then
    printf '%s: cannot resolve package name: %s\n' "${0##*/}" "$1"
    exit 1
fi
n=0
for pkg in $pkgs
do
    if [ "$pkg" = "$1" ]
    then
        n=1
        break
    fi
    n=$((n + 1))
done
if [ $n -ne 1 ]
then
    printf '%s: cannot disambiguate package name: %s\n' "${0##*/}" "$1"
    exit 1
fi
upkg=$(urlescape "$pkg")
url="https://buildd.debian.org/status/package.php?p=$upkg"
exec sensible-browser "$url"

# vim:ts=4 sts=4 sw=4 et
